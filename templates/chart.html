{% extends "layout.html" %}

{% block title %}Phân Tích Bệnh Tim{% endblock title %}

{% block body %}
<link rel="stylesheet" href="/static/css/chart-style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<section class="container mt-5">
    <!-- Biểu đồ tỷ lệ bệnh tim -->
    <div class="chart-title">Tỷ LỆ BỆNH TIM</div>
    <div class="row">
        <div class="col-md-6">
            <canvas id="heartDiseaseChart"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="riskFactorsChart"></canvas>
        </div>
    </div>

    <!-- Biểu đồ tương quan các yếu tố rủi ro -->
    <div class="chart-title">MA TRẬN TƯƠNG QUAN CÁC YẾU TỐ RỦI RO</div>
    <div class="row mt-5">
        <div class="col-md-12">
            <canvas id="correlationChart"></canvas>
        </div>
    </div>

    <!-- Biểu đồ phân loại dự đoán mắc bệnh tim -->
    <div class="chart-title">Dự Đoán Tỷ Lệ Mắc Bệnh Tim</div>
    <div class="row">
        <div class="col-md-6">
            <canvas id="classificationChart"></canvas>
        </div>
    </div>

    <!-- Biểu đồ phân tích cụm nguy cơ bệnh tim -->
    <div class="chart-title">Phân Tích Cụm Nguy Cơ Bệnh Tim</div>
    <div class="row">
        <div class="col-md-12">
            <canvas id="clusteringChart"></canvas>
        </div>
    </div>
</section>

<script>
    // Biểu đồ tỷ lệ bệnh tim
    var heartDiseaseCtx = document.getElementById('heartDiseaseChart').getContext('2d');
    var heartDiseaseChart = new Chart(heartDiseaseCtx, {
        type: 'pie',
        data: {
            labels: ['Có Bệnh Tim', 'Không Có Bệnh Tim'],
            datasets: [{
                data: [{{ heart_disease_positive }}, {{ heart_disease_negative }}],
    backgroundColor: ['#FF6384', '#36A2EB']
    }]
    },
    options: {
        responsive: true,
            plugins: {
            title: {
                display: true,
                    text: 'Tỷ Lệ Bệnh Tim'
            }
        }
    }
    });

    // Biểu đồ các yếu tố rủi ro
    var riskFactorsCtx = document.getElementById('riskFactorsChart').getContext('2d');
    var riskFactorsChart = new Chart(riskFactorsCtx, {
        type: 'bar',
        data: {
            labels: ['Tuổi', 'Huyết Áp', 'Cholesterol', 'Đường Huyết'],
            datasets: [{
                label: 'Mức Độ Rủi Ro',
                data: [{{ age_risk }}, {{ bp_risk }}, {{ cholesterol_risk }}, {{ glucose_risk }}],
    backgroundColor: [
        'rgba(255, 99, 132, 0.6)',
        'rgba(54, 162, 235, 0.6)',
        'rgba(255, 206, 86, 0.6)',
        'rgba(75, 192, 192, 0.6)'
    ]
    }]
    },
    options: {
        responsive: true,
            scales: {
            y: {
                beginAtZero: true,
                    title: {
                    display: true,
                        text: 'Mức Độ Rủi Ro'
                }
            }
        },
        plugins: {
            title: {
                display: true,
                    text: 'CÁC YẾU TỐ RỦI RO BỆNH TIM'
            }
        }
    }
    });

    // Biểu đồ tương quan (heatmap)
    var correlationCtx = document.getElementById('correlationChart').getContext('2d');
    var correlationData = [
        {x: 'Tuổi', y: 'Tuổi', v: 1},
        {x: 'Tuổi', y: 'Huyết Áp', v: {{ age_bp_corr }}},
    {x: 'Tuổi', y: 'Cholesterol', v: {{ age_cholesterol_corr }}},
    {x: 'Tuổi', y: 'Đường Huyết', v: {{ age_glucose_corr }}},
    {x: 'Huyết Áp', y: 'Huyết Áp', v: 1},
    {x: 'Huyết Áp', y: 'Cholesterol', v: {{ bp_cholesterol_corr }}},
    {x: 'Huyết Áp', y: 'Đường Huyết', v: {{ bp_glucose_corr }}},
    {x: 'Cholesterol', y: 'Cholesterol', v: 1},
    {x: 'Cholesterol', y: 'Đường Huyết', v: {{ cholesterol_glucose_corr }}},
    {x: 'Đường Huyết', y: 'Đường Huyết', v: 1}
    ];

    var correlationChart = new Chart(correlationCtx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Tương Quan',
                data: correlationData.map(item => ({x: item.x, y: item.y, r: Math.abs(item.v) * 10})),
                backgroundColor: correlationData.map(item => `rgba(75, 192, 192, ${Math.abs(item.v)})`)
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Ma Trận Tương Quan CÁC YẾU TỐ RỦI RO'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `Tương Quan: ${context.raw.r.toFixed(2)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    type: 'category',
                    labels: ['Tuổi', 'Huyết Áp', 'Cholesterol', 'Đường Huyết']
                },
                y: {
                    type: 'category',
                    labels: ['Tuổi', 'Huyết Áp', 'Cholesterol', 'Đường Huyết']
                }
            }
        }
    });

    // Biểu đồ phân loại dự đoán mắc bệnh tim
    var classificationCtx = document.getElementById('classificationChart').getContext('2d');
    var classificationChart = new Chart(classificationCtx, {
        type: 'pie',
        data: {
            labels: ['Có Bệnh Tim', 'Không Có Bệnh Tim'],
            datasets: [{
                data: [{{ heart_disease_positive }}, {{ heart_disease_negative }}],
    backgroundColor: ['#FF6384', '#36A2EB']
    }]
    },
    options: {
        responsive: true,
            plugins: {
            title: {
                display: true,
                    text: 'Dự Đoán Tỷ Lệ Mắc Bệnh Tim'
            }
        }
    }
    });

    // Biểu đồ phân tích cụm nguy cơ bệnh tim
    // Biểu đồ phân tích cụm nguy cơ bệnh tim
    var clusteringCtx = document.getElementById('clusteringChart').getContext('2d');
    var clusteringData = {{ chart_data | tojson }}; // Dữ liệu phân cụm từ Python

    var clusteringChart = new Chart(clusteringCtx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Cluster 1',
                data: clusteringData.filter(item => item.cluster === 1).map(item => ({x: item.age, y: item.cholesterol, r: 10})),
                backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }, {
                label: 'Cluster 2',
                data: clusteringData.filter(item => item.cluster === 2).map(item => ({x: item.age, y: item.cholesterol, r: 10})),
                backgroundColor: 'rgba(255, 99, 132, 0.6)'
            }, {
                label: 'Cluster 3',
                data: clusteringData.filter(item => item.cluster === 3).map(item => ({x: item.age, y: item.cholesterol, r: 10})),
                backgroundColor: 'rgba(153, 102, 255, 0.6)'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Phân Tích Cụm Nguy Cơ Bệnh Tim'
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Tuổi'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Cholesterol'
                    }
                }
            }
        }
    });
</script>

{% endblock body %}
