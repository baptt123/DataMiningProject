{% extends "layout.html" %}

{% block title %}Home{% endblock title %}

{% block body %}
<link rel="stylesheet" href="/static/css/datapatient.css">

<!-- Page Header with Parallax effect -->
<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/heart5.jpg') }}'); height: 500px; background-attachment: fixed; background-size: cover;">
    <div class="container position-relative px-4 px-lg-5 h-100">
        <div class="row h-100 justify-content-center align-items-center">
            <div class="col-md-12 text-center">
                <div class="site-heading text-white" style="font-family: 'Montserrat', sans-serif;">
                    <h1 class="display-4 font-weight-bold">{{ params['blog_name'] }}</h1>
                    <p class="lead">Heart Failure Prediction System</p>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<div class="container px-4 px-lg-5 mt-5">
    <!-- Export Buttons -->
    <div class="mb-4">
        <button class="btn btn-primary" id="exportPdfBtn">Export as PDF</button>
        <button class="btn btn-success" id="exportExcelBtn">Export as Excel</button>
    </div>

    <!-- Data Table with enhanced style -->
    <div class="table-responsive shadow-lg rounded">
        <table class="table table-hover align-middle table-striped table-bordered" id="dataTable">
            <thead class="thead-light bg-gradient text-white">
                <tr>
                    <th>#</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Chest Pain Type</th>
                    <th>Resting Blood Pressure</th>
                    <th>Cholesterol</th>
                    <th>Max Heart Rate</th>
                    <th>Exercise Angina</th>
                    <th>Blood Sugar</th>
                    <th>Diagnosis</th>
                </tr>
            </thead>
            <tbody>
                {% for record in data %}
                <tr class="hover-effect">
                    <td>{{ loop.index }}</td>
                    <td>{{ record[0] }}</td>
                    <td>{{ record[1] }}</td>
                    <td>{{ record[2] }}</td>
                    <td>{{ record[3] }}</td>
                    <td>{{ record[4] }}</td>
                    <td>{{ record[5] }}</td>
                    <td>{{ record[6] }}</td>
                    <td>{{ record[7] }}</td>
                    <td>{{ record[8] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Scroll to Top Button -->
<button id="scrollTopBtn" title="Go to top">&#8593;</button>

<!-- Scripts for Exporting PDF and Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script> <!-- Added autoTable plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>

<script src="/static/js/datapatient.js"></script>

<script>
    // PDF Export Function
    document.getElementById('exportPdfBtn').addEventListener('click', function() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const table = document.getElementById('dataTable');

        // Use autoTable plugin to generate the table in PDF
        doc.autoTable({
            html: table,
            startY: 20, // Adjust to avoid header overlap
            theme: 'grid', // Optional: adjust table style (e.g., 'striped', 'grid', etc.)
        });

        doc.save('data.pdf');
    });

    // Excel Export Function
    document.getElementById('exportExcelBtn').addEventListener('click', function() {
        const table = document.getElementById('dataTable');
        const wb = XLSX.utils.table_to_book(table, { sheet: 'Sheet1' });
        XLSX.writeFile(wb, 'data.xlsx');
    });
</script>

{% endblock %}
